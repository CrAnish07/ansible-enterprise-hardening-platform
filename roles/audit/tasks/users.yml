---
- name: Check required users exist
  command: id {{ item }}
  loop: "{{ audit_expected.users }}"
  register: audit_user_check
  ignore_errors: true
  changed_when: false

- name: Fail if required user is missing
  fail:
    msg: "SECURITY DRIFT: Required user missing!"
  when: user_check is failed

